{% extends 'sfrp/sfrp_base.html' %} {# Extend your base template for consistent styling #}
{% load i18n %} {# Load i18n for translations #}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-10 col-lg-8"> {# Wider column for FAQ content #}
            <h1 class="text-center mb-4">
                <i class="fas fa-question-circle text-info mr-2"></i> {{ page_title }}
            </h1>

            {% if categorized_faqs %}
                {# NEW: Added id="faqAccordion" to the div that wraps all category cards #}
                <div id="faqAccordion"> 
                    {% for category, items in categorized_faqs.items %}
                        <div class="card shadow-sm mb-4">
                            <div class="card-header bg-primary text-white p-3" id="heading{{ category.id }}">
                                <h2 class="mb-0">
                                    <button class="btn btn-link text-white w-100 text-left d-flex justify-content-between align-items-center" type="button" data-toggle="collapse" data-target="#collapseCategory{{ category.id }}" aria-expanded="true" aria-controls="collapseCategory{{ category.id }}">
                                        {{ category.name }}
                                        <i class="fas fa-chevron-down"></i>
                                    </button>
                                </h2>
                            </div>

                            <div id="collapseCategory{{ category.id }}" class="collapse {% if forloop.first %}show{% endif %}" aria-labelledby="heading{{ category.id }}" data-parent="#faqAccordion">
                                <div class="card-body p-0"> {# No padding here, as accordions have their own #}
                                    <div class="accordion" id="accordionCategory{{ category.id }}">
                                        {% for item in items %}
                                            <div class="card mb-0 border-left-0 border-right-0 {% if not forloop.last %}border-bottom{% endif %}">
                                                <div class="card-header bg-white p-3" id="headingItem{{ item.id }}">
                                                    <h3 class="mb-0">
                                                        <button class="btn btn-link text-dark w-100 text-left d-flex justify-content-between align-items-center" type="button" data-toggle="collapse" data-target="#collapseItem{{ item.id }}" aria-expanded="false" aria-controls="collapseItem{{ item.id }}">
                                                            {{ item.question }}
                                                            <i class="fas fa-plus"></i>
                                                        </button>
                                                    </h3>
                                                </div>

                                                <div id="collapseItem{{ item.id }}" class="collapse" aria-labelledby="headingItem{{ item.id }}" data-parent="#accordionCategory{{ category.id }}">
                                                    <div class="card-body">
                                                        {{ item.answer|linebreaksbr }} {# Renders newlines as <br> tags #}
                                                        
                                                        {# Display Tags below the answer #}
                                                        {% if item.tags.all %}
                                                            <div class="mt-3 pt-3 border-top">
                                                                <strong>Tags:</strong>
                                                                {% for tag in item.tags.all %}
                                                                    <span class="badge badge-info mr-1">{{ tag.name }}</span>
                                                                {% endfor %}
                                                            </div>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div> {# NEW: Closing tag for #faqAccordion #}
            {% else %}
                <div class="alert alert-info text-center" role="alert">
                    {% trans "No FAQ items found at the moment. Please check back later!" %}
                </div>
            {% endif %}
        </div>
    </div>
</div>

{# Ensure Bootstrap JS and jQuery are loaded for collapse functionality #}
{# These should typically be in your sfrp_base.html, but including a reminder here #}
{# <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script> #}
{# <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script> #}
{% endblock content %}